<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MedTime â€“ Lembretes de MedicaÃ§Ã£o (PWA)</title>
  <meta name="theme-color" content="#0ea5e9" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="app" class="mx-auto max-w-3xl p-4">
    <header class="flex items-center justify-between mb-6">
      <h1 class="text-2xl font-bold">ðŸ’Š MedTime</h1>
      <div class="flex items-center gap-2">
        <button @click="$refs.installModal.abrir()" title="Ajuda para instalar" class="rounded-full bg-slate-200 w-8 h-8 flex items-center justify-center text-slate-600 font-bold text-lg hover:bg-slate-300">?</button>
      </div>
    </header>
    <div v-if="userData" class="min-h-[24rem]">
      <!-- Barra de NavegaÃ§Ã£o das Abas -->
      <nav class="flex justify-around items-center mb-6 bg-white p-2 rounded-2xl shadow-md">
        <button v-for="t in tabs" :key="t.key" @click="navigateTo(t.key)" :class="btnClass(tab === t.key)">
          {{ t.label }}
        </button>
      </nav>

      <div>
        <transition :name="transitionName" mode="out-in">
          <component :is="currentTabComponent" :key="tab"></component>
        </transition>
      </div>
    </div>
    <div v-else class="text-center bg-white p-8 rounded-2xl shadow-md">
      <h2 class="text-2xl font-bold mb-4">Bem-vindo ao MedTime!</h2>
      <p class="mb-6 text-slate-600">Crie um perfil para comeÃ§ar a gerenciar seus medicamentos.</p>
      <button @click="abrirModalCriarPerfil" class="w-full max-w-xs mx-auto rounded-xl bg-sky-600 px-4 py-2.5 text-white font-semibold shadow-md hover:bg-sky-700">
        Criar Perfil
      </button>
    </div>

    <confirmacao-modal
      :visivel="!!medicamentoParaExcluir"
      titulo="Excluir Medicamento"
      :mensagem="`Tem certeza que deseja excluir o medicamento <strong>${medicamentoParaExcluir?.nome || ''}</strong>?`"
      @confirmar="confirmarExclusao()"
      @cancelar="medicamentoParaExcluir = null"
    ></confirmacao-modal>

    <criar-perfil v-if="showCriarPerfilModal" @perfil-criado="onPerfilCriado" @fechar="fecharModalCriarPerfil"></criar-perfil>
    <!-- Modal de ConfirmaÃ§Ã£o para Apagar Perfil -->
    <confirmacao-modal
      :visivel="!!perfilParaApagar"
      titulo="Apagar Perfil"
      :mensagem="`Tem certeza que deseja apagar seu perfil e todos os dados associados? Esta aÃ§Ã£o nÃ£o pode ser desfeita.`"
      @confirmar="apagarPerfil"
      @cancelar="cancelarApagarPerfil"
    ></confirmacao-modal>

    <!-- Modal de Finalizar Tratamento -->
    <finalizar-tratamento-modal
      :visivel="!!medicamentoParaFinalizar"
      :medicamento="medicamentoParaFinalizar"
      @cancelar="cancelarFinalizacaoTratamento"
      @confirmar="confirmarFinalizacaoTratamento"
    ></finalizar-tratamento-modal>

    <!-- Modal de Ajuda para InstalaÃ§Ã£o -->
    <install-help-modal ref="installModal" @instalar="instalarApp"></install-help-modal>

    <footer class="mt-10 text-center text-xs text-slate-500">
      <p>Funciona offline (PWA). NotificaÃ§Ãµes dependem das permissÃµes do navegador.</p>
    </footer>

    <!-- Ãudio para notificaÃ§Ã£o customizada -->
    <audio id="notification-sound" src="assets/notification.mp3" preload="auto"></audio>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(()=>{});
      });
    }
  </script>
  <script type="module" src="main.js"></script>
</body>
</html>
